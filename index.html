<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Music Love</title>
    <meta
      name="viewport"
      content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, shrink-to-fit=no, viewport-fit=cover"
    />
    <meta name="author" content="Martin Myburgh" />
    <meta
      name="description"
      content="Music Love, your hub for unlimited entertainment."
    />
    <!-- Favicon -->
    <link rel="icon" href="favicon.ico" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="profile.png"
    />
    <!-- In the head section -->
    <script type="module">
      import config from './config.js';
      window.YOUTUBE_API_KEY = config.YOUTUBE_API_KEY;
    </script>
    <!-- Tailwind CSS -->
    <link href="tailwind.css" rel="stylesheet" type="text/css" />
    <style>
      /* Ensure body is visible by default */
      body {
        background-color: #0f0f0f;
        margin: 0;
        font-family: "Roboto", sans-serif;
        color: white;
        overflow: auto; /* Prevent body overflow */
      }

      /* Loading Spinner Styles */
      .loading {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #0f0f0f;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
      }

      .loading.hidden {
        display: none;
      }

      .container {
        background-color: #0f0f0f;
      }

      .button {
        width: 9rem;
        padding: 0.5rem 1rem;
        font-size: 0.9rem;
        font-weight: normal;
        border-radius: 0.4rem;
        border: 1px solid transparent;
        color: #ffffff;
        background-color: transparent;
        margin-right: 0.5rem;
        cursor: pointer;
        transition: font-size 0.3s ease, color 0.3s ease, border 0.3s ease;
        flex: 0 0 auto;
      }

      .button:hover {
        background-color: transparent;
        color: #f6161c;
      }

      .selected {
        font-size: 1rem;
        font-weight: bolder;
        background-color: transparent;
        color: #f6161c;
        border: 2px solid #f6161c;
      }

      .button-container {
        display: flex;
        flex-wrap: nowrap;
        overflow-x: hidden;
        overflow-y: hidden;
        scroll-behavior: smooth;
        max-width: 100%;
        position: relative;
      }

      .arrow {
        background: transparent;
        padding: 0.9rem;
        cursor: pointer;
        transition: background-color 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .arrow:hover {
        background-color: rgba(255, 0, 0, 0.1);
      }

      .arrow svg {
        fill: red;
        width: 1.9rem;
        height: 1.9rem;
      }

      .arrow-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 100%;
        overflow: hidden;
      }

      .youtube-container {
        position: relative;
        padding-bottom: 56.25%; /* 16:9 aspect ratio */
        height: 0;
        overflow: hidden;
        background-color: #0f0f0f;
      }
      
      #youtube-player {
        position: absolute !important; /* Force position over YouTube's default */
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
      }
      
      .youtube-iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
      }
      
      .youtube-error {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #f6161c;
        text-align: center;
      }

      .youtube-error {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #f6161c;
        text-align: center;
      }

      footer {
        background-color: #000000;
        padding: 1rem;
        text-align: center;
        color: #fff;
        overflow: hidden;
      }

      footer a {
        color: #f6161c;
        text-decoration: none;
      }

      .text-ytplus {
        color: #f6161c;
        text-decoration: none;
      }

      @media (max-width: 1024px) {
        .button {
          width: 7rem;
          padding: 0.4rem 0.8rem;
          font-size: 0.9rem;
        }
      }

      @media (max-width: 768px) {
        .button {
          width: 6rem;
          padding: 0.3rem 0.6rem;
          font-size: 0.8rem;
        }

        .arrow svg {
          width: 1.4rem;
          height: 1.4rem;
        }
      }

      @media (max-width: 480px) {
        .button {
          width: 5rem;
          padding: 0.25rem 0.5rem;
          font-size: 0.7rem;
        }

        .arrow svg {
          width: 1.2rem;
          height: 1.2rem;
        }
      }

      @media (max-width: 320px) {
        .button {
          width: 4rem;
          padding: 0.2rem 0.4rem;
          font-size: 0.6rem;
        }

        .arrow svg {
          width: 1rem;
          height: 1rem;
        }
      }

      .lds-dual-ring,

      .lds-dual-ring:after {
        box-sizing: border-box;
      }
      .lds-dual-ring {
        display: inline-block;
        width: 80px;
        height: 80px;
      }
      .lds-dual-ring:after {
        color:red;
        content: " ";
        display: block;
        width: 64px;
        height: 64px;
        margin: 8px;
        border-radius: 50%;
        border: 6.4px solid currentColor;
        border-color: currentColor transparent currentColor transparent;
        animation: lds-dual-ring 0.50s linear infinite;
      }
      @keyframes lds-dual-ring {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }



    </style>
  </head>
  <body class="flex">

    <div class="container font-light font-sans mx-auto my-0 p-4 text-sm">
      <!-- Bio Section -->
      <div class="flex justify-center">
        <div class="w-full md:w-1/2 text-center">
          <div
            class="flex flex-col items-center justify-center text-center md:flex-row"
          >
            <img
              id="profile-image"
              class="p-2 rounded-full"
              alt="Music Love"
              width="140"
              height="140"
            />
          </div>
          <div class="text-3xl">
            <p class="pb-8 pt-4">
              <a
                class="text-ytplus hover:text-white"
                href="https://youtube.com/@theradiostream"
                target="_blank"
                rel="noopener noreferrer"
                >mo͞o</a
              ><a
                class="text-ytplus hover:text-white"
                href="https://youtube.com/@theradiostream"
                target="_blank"
                rel="noopener noreferrer"
                >zik</a
              >
            </p>
          </div>
        </div>
      </div>
      <!-- YouTube Embed Section -->
      <div class="flex justify-center">
        <div class="w-full md:w-2/3 rounded-lg overflow-hidden">
          <div class="youtube-container">
            <div id="youtube-player"></div>
            <!-- Eror message container -->
            <div id="youtube-error" class="youtube-error" style="display: none;">
              Failed to load video player
            </div>
          </div>
        </div>
      </div>
      <!-- Button Navigation with Arrows -->
      <div class="arrow-container mx-auto py-2">
        <!-- Left Arrow -->
        <button class="arrow" id="left-arrow">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M15 18l-6-6 6-6" />
          </svg>
        </button>
        <!-- Scrollable Buttons Section -->
        <div
          class="button-container flex justify-center gap-2 px-4"
          id="button-container"
        >
          <!-- Buttons will be dynamically added here -->
        </div>
        <!-- Right Arrow -->
        <button class="arrow" id="right-arrow">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M9 6l6 6-6 6" />
          </svg>
        </button>
      </div>
      <!-- Footer -->
      <div class="flex-grow"></div>
      <footer class="text-center px-4 pb-8 pt-8 gap-1 rounded-lg">
        <p>
          Powered by
          <a
            class="text-ytplus hover:text-white"
            href="https://youtube.com/@theradiostream"
            target="_blank"
            rel="noopener noreferrer"
            >mo͞ozik</a
          >
        </p>
      </footer>
      <div class="py-2">
        <p class="text-center text-xs sm:text-sm text-gray-500">
          Made with music
          <a
            class="text-ytplus hover:text-white"
            href="https://youtube.com/@theradiostream"
            target="_blank"
            rel="noopener noreferrer"
            >❤️</a
          >
          from South Africa
        </p>
      </div>
    </div>

    <!-- JavaScript -->
    <script>
      const data = {
        bio: {
          name: "John Doe",
          title: "Playlist Curator",
          description:
            "YouTube Plus is a curated playlist collection of the best music videos on YouTube. Enjoy the latest hits and dance tracks from around the world.",
          image: "profile.png",
        },
        playlists: [

          {
            title: "Afrikaans",
            url: "https://www.youtube.com/playlist?list=RDEMrXlQOvXJrmnCFsKcLG_LqA",
          },

          {
            title: "Hits List",
            url: "https://www.youtube.com/playlist?list=RDCLAK5uy_kmPRjHDECIcuVwnKsx2Ng7fyNgFKWNJFs",
          },

          {
            title: "Pop Hits",
            url: "https://www.youtube.com/playlist?list=RDCLAK5uy_nhf3h98yS3LCk_bVNQu6GjWG7ARvMaiFQ",
          },

          {
            title: "Rock",
            url: "https://www.youtube.com/playlist?list=RDCLAK5uy_lfU6d5d-whk0KvABtxS0yZrj6n4NW2eTM",
          },

          {
            title: "R&B",
            url: "https://www.youtube.com/playlist?list=RDCLAK5uy_mu-BhJj3yO1OXEMzahs_aJVtNWJwAwFEE",
          },

          {
            title: "Indie",
            url: "https://www.youtube.com/playlist?list=RDCLAK5uy_l4QirOJJ99DTK5t5h7PdS_apsSClRfPpc",
          },

          {
            title: "Alternative",
            url: "https://www.youtube.com/playlist?list=RDCLAK5uy_n4oG0HK-gS2c_tstquxLhCBjs-CF2g8Qg",
          },

          {
            title: "Decibles",
            url: "https://www.youtube.com/playlist?list=RDCLAK5uy_k5vcGRXixxemtzK1eKDS7BeHys7mvYOdk",
          },

          {
            title: "Beats",
            url: "https://www.youtube.com/playlist?list=RDCLAK5uy_lDmrvWsJapdRC-uQzUdJmc1tPWB-jkzRM",
          },

          {
            title: "Electronica",
            url: "https://www.youtube.com/playlist?list=RDCLAK5uy_kBbljBMZ2exMXUc3MZdtXHsMwvGqf3eE8",
          },

          {
            title: "Dance Hits",
            url: "https://www.youtube.com/playlist?list=RDCLAK5uy_kLWIr9gv1XLlPbaDS965-Db4TrBoUTxQ8",
          },

          {
            title: "Sing-Along",
            url: "https://www.youtube.com/playlist?list=RDCLAK5uy_nUi8B-S9ckz5feHM7oMGyQQ_eKW2Zl9aE",
          }

        ],
      };

      // Add these player-related functions right after the variable declarations
      let player;
      let apiKey;
      
      // Player event handlers
      function onPlayerReady(event) {
        try {
          // Just load the playlist without playing
          const firstPlaylist = data.playlists[0];
          const listId = extractPlaylistId(firstPlaylist.url);
          if (listId) {
            player.cuePlaylist({
              list: listId,
              listType: 'playlist',
              index: 0
            });
          }
          selectButton(0);
          centerButton(0);
        } catch (error) {
          console.error('Error in onPlayerReady:', error);
          document.getElementById('youtube-error').style.display = 'block';
        }
      }
      
      function onPlayerError(event) {
        console.error('Player Error:', event.data);
        document.getElementById('youtube-error').style.display = 'block';
      }
      
      function initPlayer() {
        if (typeof YT === 'undefined' || !YT.Player) {
          setTimeout(initPlayer, 100);
          return;
        }
        try {
          player = new YT.Player('youtube-player', {
            height: '100%',
            width: '100%',
            playerVars: {
              autoplay: 0, // Disable autoplay
              controls: 1, // Enable player controls
              rel: 0,
              modestbranding: 1,
              enablejsapi: 1,
              playsinline: 1,
              fs: 1
            },
            events: {
              'onReady': onPlayerReady,
              'onError': onPlayerError,
              'onStateChange': onPlayerStateChange
            }
          });
        } catch (error) {
          console.error('Failed to initialize player:', error);
          document.getElementById('youtube-error').style.display = 'block';
        }
      }
      
      // Add player state change handler
      function onPlayerStateChange(event) {
      const playerElement = document.querySelector('#youtube-player iframe');
      if (playerElement) {
        playerElement.style.visibility = 'visible';
        playerElement.style.opacity = '1';
      }
  
        // Hide error message if player is working
        if (event.data !== YT.PlayerState.ERROR) {
          document.getElementById('youtube-error').style.display = 'none';
        }
      }
      
      // YouTube API functions
      async function fetchPlaylistItems(playlistId) {
        try {
            const response = await fetch(
              `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${playlistId}&key=${apiKey}`
            );
            const data = await response.json();
        
            if (data.error) {
              console.error('YouTube API Error:', data.error);
              document.getElementById('youtube-error').style.display = 'block';
              return null;
            }
        
            return data;
          } catch (error) {
            console.error('Failed to fetch playlist:', error);
            document.getElementById('youtube-error').style.display = 'block';
            return null;
          }
        }
        
      async function loadPlaylist(index) {
        const playlist = data.playlists[index];
        const listId = extractPlaylistId(playlist.url);
        if (!listId) {
          console.error('Invalid playlist URL');
          return;
        }

        try {
          if (player && player.cuePlaylist) {
            // Stop current video/playlist if playing
            player.stopVideo();
            // Immediately load the new playlist
            player.cuePlaylist({
              list: listId,
              listType: 'playlist',
              index: 0
            });
          }
        } catch (error) {
          console.error('Error loading playlist:', error);
          document.getElementById('youtube-error').style.display = 'block';
        }
      }
      
      function extractPlaylistId(url) {
        const regex = /[?&]list=([^&]+)/;
        const match = url.match(regex);
        return match ? match[1] : null;
      }
      
      function handleResize() {
        const container = document.querySelector('.youtube-container');
        if (container && player) {
          const width = container.clientWidth;
          const height = width * (9/16); // maintain 16:9 aspect ratio
          player.setSize(width, height);
        }
      }
            
      document.addEventListener("DOMContentLoaded", async () => {
        // Import and set up API key
        try {
          const configModule = await import('./config.js');
          apiKey = configModule.default.YOUTUBE_API_KEY;
          
          if (!apiKey) {
            throw new Error('YouTube API key not found');
          }
        } catch (error) {
          console.error('Failed to load config:', error);
          document.getElementById('youtube-error').style.display = 'block';
          return;
        }
      
        // Load YouTube IFrame API
        const tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        const firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
      
        // Set up YouTube API callback
        window.onYouTubeIframeAPIReady = initPlayer;
        
        // Resize the player when the window is resized
        window.addEventListener('resize', handleResize);
      
        // Initialize UI
        loadButtons();
        calculateButtonWidth();
        loadBio();
        
        // Set up event listeners
        document.getElementById("left-arrow").addEventListener("click", scrollLeft);
        document.getElementById("right-arrow").addEventListener("click", scrollRight);
        window.addEventListener("resize", calculateButtonWidth);
        
        // Touch events for mobile
        const buttonContainer = document.getElementById("button-container");
        buttonContainer.addEventListener("touchstart", handleTouchStart);
        buttonContainer.addEventListener("touchmove", handleTouchMove);
        buttonContainer.addEventListener("touchend", handleTouchEnd);
      });
      
      let buttonWidth = 280; // Default button width in pixels

      function calculateButtonWidth() {
        const button = document.querySelector(".button");
        if (button) {
          buttonWidth =
            button.offsetWidth + parseInt(getComputedStyle(button).marginRight);
        }
      }

      function loadBio() {
        document.getElementById("profile-image").src = data.bio.image;
      }

      function loadButtons() {
        const buttonContainer = document.querySelector(".button-container");

        data.playlists.forEach((playlist, index) => {
          const button = createButton(playlist, index);
          buttonContainer.appendChild(button);
        });

        selectButton(0);
        centerButton(0);
      }

      function centerButton(index) {
        const buttonContainer = document.getElementById("button-container");
        const button = document.getElementById(`btn-${index}`);
        const containerWidth = buttonContainer.offsetWidth;
        const buttonLeft = button.offsetLeft;
        const buttonWidth = button.offsetWidth;

        buttonContainer.scrollLeft =
          buttonLeft - containerWidth / 2 + buttonWidth / 2;
      }

      function createButton(playlist, index) {
        const button = document.createElement("button");
        button.classList.add("button");
        button.textContent = playlist.title;
        button.id = `btn-${index}`;
        button.onclick = () => {
          // Immediately load playlist and update UI
          loadPlaylist(index);
          selectButton(index);
          centerButton(index);
        };
        return button;
      }

      // Function to check if the device is iOS or Android
      function isMobile() {
        return /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
      }

      function selectButton(selectedId) {
        document.querySelectorAll(".button").forEach((button) => {
          const buttonId = button.id.split("-")[1];
          button.classList.toggle("selected", buttonId == selectedId);
        });
      }

      function scrollRight() {
        const container = document.getElementById("button-container");
        const firstButton = container.firstElementChild;

        container.appendChild(firstButton);
        container.scrollRight += buttonWidth;
      }

      function scrollLeft() {
        const container = document.getElementById("button-container");
        const lastButton = container.lastElementChild;

        container.prepend(lastButton);
        container.scrollLeft -= buttonWidth;
      }

      // Touch handling for touch-sensitive scrolling
      let isTouching = false;
      let startX = 0;
      let touchScrollLeft = 0;

      function handleTouchStart(event) {
        isTouching = true;
        startX = event.touches[0].pageX;
        touchScrollLeft =
          document.getElementById("button-container").scrollLeft;
      }

      function handleTouchMove(event) {
        if (!isTouching) return;
        const touchX = event.touches[0].pageX;
        const walk = (touchX - startX) * 1.5;
        document.getElementById("button-container").scrollLeft =
          touchScrollLeft - walk;
      }

      function handleTouchEnd() {
        isTouching = false;
      }

    </script>
  </body>
</html>
